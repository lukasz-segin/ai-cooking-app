# Fetch Recipes from API

**Fetch Recipes from API** is a custom WordPress plugin designed to bridge the gap between an AI-powered Django backend and a WordPress frontend. It automates the process of importing, formatting, and updating recipes generated by the external application.

## üöÄ Features

* **Automated Synchronization:** Runs an hourly cron job to fetch new recipes from the configured Django API endpoint.
* **Smart Updates:** Checks `updated_at` timestamps to ensure only modified recipes are updated, preventing unnecessary database writes.
* **Content Formatting:** automatically parses raw text instructions (ingredients, steps, nutrition) into structured HTML with proper CSS classes.
* **SEO Optimization:** Generates and injects **Schema.org Recipe JSON-LD** structured data for better search engine visibility.
* **Image Handling:** Automatically downloads remote images from the API, saves them to the WordPress Media Library, and sets them as the **Featured Image**.
* **Draft Mode:** Imports new recipes as "Drafts" by default, allowing for manual review before publishing.
* **Admin Interface:** Includes a dashboard under the "Tools" menu for manual triggering and status monitoring.

## ‚öôÔ∏è Requirements

* WordPress 5.0+
* PHP 7.4+
* Access to the Django API endpoint (default: `localhost:8000`)

## üì¶ Installation

1.  Download or clone this repository into your WordPress plugins directory:
    ```path
    /wp-content/plugins/fetch-recipes/
    ```
2.  **Configuration (Important):**
    Open `fetch-recipes.php` and update the `$api_url` variable (approx. line 50) to point to your actual API endpoint if it differs from localhost:
    ```php
    $api_url = '[http://your-django-app.com/api/recipes/](http://your-django-app.com/api/recipes/)';
    ```
3.  Activate the plugin through the WordPress admin dashboard.
4.  Upon activation, the plugin will attempt an immediate fetch.

## üñ•Ô∏è Usage

### Automatic Mode
The plugin registers a WordPress cron event `fr_fetch_recipes_event` that runs **hourly**. No manual intervention is required.

### Manual Mode
You can trigger the fetch process manually (e.g., for testing or forcing an update):
1.  Go to **Tools > Fetch Recipes** in the WordPress Admin Dashboard.
2.  Click the **"Fetch Recipes Now"** button.
3.  The page will display the number of created and updated recipes.

## üß© How It Works

1.  **Fetching:** The plugin sends a GET request to the Django API.
2.  **Parsing:** It decodes the JSON response containing recipe data.
3.  **Duplication Check:** It checks if a post with the specific `fr_recipe_id` meta key already exists.
4.  **Formatting:**
    * Extracts `# Ingredients` -> `<ul>` list.
    * Extracts `# Instructions` -> `<ol>` list.
    * Extracts Prep/Cook times and Nutritional Info.
5.  **Media:** If an `image_url` is provided, the image is sideloaded into the Media Library and attached to the post.
6.  **Storage:**
    * **New Recipe:** Created as a `draft`.
    * **Existing Recipe:** Updated only if the remote `updated_at` is newer than the local copy.

## üîß Technical Details

### Custom Fields (Post Meta)
The plugin uses the following meta keys to track synchronization:
* `fr_recipe_id`: The unique ID of the recipe from the Django database.
* `fr_recipe_updated_at`: The timestamp of the last update from the source.

### SSL Verification
**Note:** Currently, `sslverify` is set to `false` in `wp_remote_get` for development compatibility (localhost). For production environments with valid SSL certificates, it is recommended to change this to `true` in `fetch-recipes.php`.

## üìù Logs
The plugin logs detailed progress and errors to the PHP error log (e.g., `debug.log`). Check your server logs to troubleshoot connection issues or parsing errors.